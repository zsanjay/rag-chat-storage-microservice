# RAG Chat Storage Microservice
### Microservice to store chat histories generated by a RAG (Retrieval-Augmented Generation) based chatbot system.

## This API supports:
##### 1. Creating and managing chat sessions
##### 2. Storing and retrieving messages
##### 3. Chatting with an AI Assistant
##### 4. Marking sessions as favorites
##### 5. Health check endpoint

---

## Non Functional Requirements

##### 1. Swagger/OpenAPI documentation.
##### 2. CORS Security
##### 3. Rate Limiting
##### 4. Centralized logging and global error handling.

---

## Other Requirements

##### 1. Unit Tests for Endpoints.
##### 2. Paginated APIs.
##### 3. Mapper for Entity to DTO Converstion.

---

## Tech Stack

- **Java 17 / Spring Boot 3+**
- **PostgreSQL** (for persistence)
- **Spring Data JPA**
- **Docker & Docker Compose**
- **OpenAPI 3.0 / Swagger UI**

---

## Environment Variables (`.env`)

```
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=chatdb
API_KEYS=key1,key2,key3
OPEN_AI_API_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
PGADMIN_DEFAULT_EMAIL=admin@admin.com
PGADMIN_DEFAULT_PASSWORD=admin
```

---

##  Setup and running instructions

#### 1. Download docker from - https://docs.docker.com/desktop/setup/install/mac-install/
#### 2. Run 'docker-compose up --build -d' command to build the image and run the docker containers in detached mode.
####    This will start 3 containers - chat-app, postgresdb and pgadmin.
#### 3. Optional Run 'docker-compose up --build -d --no-cache' command to delete the cache and build the image and run the docker containers.

---

## Test Health

#### curl http://localhost:8081/health
---

## API Endpoints

#### Sessions

| Method     | Endpoint                                | Description                           |
| ---------- | --------------------------------------- | ------------------------------------- |
| **GET**    | `/api/v1/sessions`                      | Get all sessions (paginated)          |
| **POST**   | `/api/v1/sessions/`                     | Create new chat session               |
| **GET**    | `/api/v1/sessions/{sessionId}`          | Get session by ID                     |
| **PUT**    | `/api/v1/sessions/{sessionId}`          | Rename a session                      |
| **PATCH**  | `/api/v1/sessions/{sessionId}/favorite` | Mark/unmark as favorite               |
| **DELETE** | `/api/v1/sessions/{sessionId}`          | Delete session (and all its messages) |

#### Example Request (Create Session)

```
curl -X POST http://localhost:8081/api/v1/sessions/ \
  -H "Content-Type: application/json" \
  -H "x-api-key: your_api_key_here" \
  -d '{
    "userId": "user123",
    "title": "AI Study Chat",
    "isFavorite": false
  }'
```

#### Example Response
```
{
  "sessionId": 1,
  "userId": "user123",
  "title": "AI Study Chat",
  "isFavorite": false
}
```

### Messages

| Method   | Endpoint                                | Description                |
| -------- | --------------------------------------- | -------------------------- |
| **GET**  | `/api/v1/sessions/{sessionId}/messages` | Get messages for a session |
| **POST** | `/api/v1/sessions/{sessionId}/messages` | Add new message            |


#### Example Request (POST message)

```
curl -X POST http://localhost:8081/api/v1/sessions/1/messages \
  -H "Content-Type: application/json" \
  -H "x-api-key: your_api_key_here" \
  -H "X-User-Id: user123" \
  -d '{
    "senderType": "USER",
    "content": "Hello, how are you?"
  }'
```

#### Example Response

```
{
  "sessionId": 1,
  "userId": "user123",
  "message": {
    "messageId": 10,
    "senderType": "USER",
    "content": "Hello, how are you?",
    "createdAt": "2025-10-04T09:32:15Z"
  }
}
```

### Chat

| Method   | Endpoint                            | Description                      |
| -------- | ----------------------------------- | -------------------------------- |
| **POST** | `/api/v1/sessions/{sessionId}/chat` | Send message and get AI response |

#### Example Request

```
curl -X POST http://localhost:8081/api/v1/sessions/1/chat \
  -H "Content-Type: application/json" \
  -H "x-api-key: your_api_key_here" \
  -d '{ "message": "Explain vector databases." }'
```

#### Example Response

```
{
  "message": "Vector databases store embeddings to enable semantic search."
}

```

### Health

| Method  | Endpoint  | Description           |
| ------- | --------- | --------------------- |
| **GET** | `/health` | Health check endpoint |

#### Example
#### curl http://localhost:8081/health


## Server will start at:

##### -- http://localhost:8081

## Swagger UI Endpoint

#### -- http://localhost:8081/swagger-ui.html










